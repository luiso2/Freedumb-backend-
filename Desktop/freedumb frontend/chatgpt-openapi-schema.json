{
  "openapi": "3.0.0",
  "info": {
    "title": "FREEDUMB Financial API",
    "description": "API para que ChatGPT interactúe con FREEDUMB, permitiendo guardar transacciones en lenguaje natural y generar widgets interactivos.",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "https://backend-production-053c.up.railway.app/api",
      "description": "Production server (Railway)"
    }
  ],
  "paths": {
    "/transactions/nlp": {
      "post": {
        "operationId": "saveTransactionFromNaturalLanguage",
        "summary": "Guardar transacción desde lenguaje natural",
        "description": "Permite al usuario guardar una transacción hablando naturalmente. Ejemplo: 'Gasté $50 en Starbucks ayer'",
        "tags": ["Transactions"],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["input"],
                "properties": {
                  "input": {
                    "type": "string",
                    "description": "Descripción en lenguaje natural de la transacción",
                    "example": "Gasté $45 en Uber para ir al aeropuerto"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Transacción guardada exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "transaction": {
                      "$ref": "#/components/schemas/Transaction"
                    },
                    "parsed": {
                      "type": "object",
                      "properties": {
                        "confidence": {
                          "type": "number"
                        },
                        "originalInput": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/transactions": {
      "get": {
        "operationId": "getTransactions",
        "summary": "Obtener transacciones del usuario",
        "description": "Devuelve las transacciones con filtros opcionales",
        "tags": ["Transactions"],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "period",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": ["day", "week", "month", "year", "all"],
              "default": "month"
            }
          },
          {
            "name": "category",
            "in": "query",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Lista de transacciones",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "transactions": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Transaction"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/ai/insights": {
      "get": {
        "operationId": "getFinancialInsights",
        "summary": "Obtener insights financieros con IA",
        "description": "Genera insights personalizados basados en el historial del usuario",
        "tags": ["AI"],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "period",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": ["month", "quarter", "year"],
              "default": "month"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Insights generados",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "insights": {
                      "type": "object"
                    },
                    "widgetUrl": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/budgets": {
      "get": {
        "operationId": "getBudgets",
        "summary": "Obtener presupuestos del usuario",
        "description": "Ver todos los presupuestos y su estado actual",
        "tags": ["Budgets"],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Lista de presupuestos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "budgets": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Budget"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "operationId": "createBudget",
        "summary": "Crear nuevo presupuesto",
        "tags": ["Budgets"],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["budget_name", "category", "amount_limit"],
                "properties": {
                  "budget_name": {
                    "type": "string",
                    "example": "Presupuesto de Comida Mensual"
                  },
                  "category": {
                    "type": "string",
                    "example": "food"
                  },
                  "amount_limit": {
                    "type": "number",
                    "example": 500
                  },
                  "period": {
                    "type": "string",
                    "enum": ["monthly", "weekly", "daily"],
                    "default": "monthly"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Presupuesto creado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Budget"
                }
              }
            }
          }
        }
      }
    },
    "/widget/generate": {
      "post": {
        "operationId": "generateWidgetUrl",
        "summary": "Generar URL de widget interactivo",
        "description": "ChatGPT usa este endpoint para generar URLs de widgets personalizados que muestran datos de forma visual e interactiva",
        "tags": ["Widget"],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["widgetType"],
                "properties": {
                  "widgetType": {
                    "type": "string",
                    "enum": ["dashboard", "transactions", "budgets", "insights", "category"],
                    "description": "Tipo de widget a generar"
                  },
                  "period": {
                    "type": "string",
                    "enum": ["day", "week", "month", "year"],
                    "default": "month"
                  },
                  "category": {
                    "type": "string",
                    "description": "Filtrar por categoría específica"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "URL del widget generada",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "widgetUrl": {
                      "type": "string",
                      "example": "https://freedumb.app/widget?user=123&period=month&token=abc123"
                    },
                    "embedCode": {
                      "type": "string",
                      "description": "Código HTML para embeber el widget"
                    },
                    "expiresAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/analytics/summary": {
      "get": {
        "operationId": "getFinancialSummary",
        "summary": "Obtener resumen financiero",
        "description": "Resumen rápido de la situación financiera actual",
        "tags": ["Analytics"],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "period",
            "in": "query",
            "schema": {
              "type": "string",
              "default": "month"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Resumen financiero",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "totalIncome": {
                      "type": "number"
                    },
                    "totalExpenses": {
                      "type": "number"
                    },
                    "balance": {
                      "type": "number"
                    },
                    "categoryBreakdown": {
                      "type": "object"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "Token JWT obtenido del endpoint /auth/login"
      }
    },
    "schemas": {
      "Transaction": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "amount": {
            "type": "number",
            "example": 45.5
          },
          "type": {
            "type": "string",
            "enum": ["income", "expense"]
          },
          "category": {
            "type": "string",
            "example": "Food & Dining"
          },
          "merchant": {
            "type": "string",
            "example": "Starbucks"
          },
          "description": {
            "type": "string"
          },
          "date": {
            "type": "string",
            "format": "date"
          }
        }
      },
      "Budget": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "budget_name": {
            "type": "string"
          },
          "category": {
            "type": "string"
          },
          "amount_limit": {
            "type": "number"
          },
          "spent": {
            "type": "number"
          },
          "remaining": {
            "type": "number"
          },
          "status": {
            "type": "string",
            "enum": ["ok", "warning", "exceeded"]
          }
        }
      }
    }
  },
  "tags": [
    {
      "name": "Transactions",
      "description": "Gestión de transacciones financieras"
    },
    {
      "name": "AI",
      "description": "Funciones potenciadas por IA"
    },
    {
      "name": "Budgets",
      "description": "Gestión de presupuestos"
    },
    {
      "name": "Widget",
      "description": "Generación de widgets interactivos"
    },
    {
      "name": "Analytics",
      "description": "Análisis y reportes financieros"
    }
  ]
}
